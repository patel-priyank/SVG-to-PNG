<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <title>SVG to PNG Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.5/babel.min.js"></script>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      function SVGToPNGConverter() {
        const [isDarkMode, setIsDarkMode] = React.useState(false);
        const [isMenuOpen, setIsMenuOpen] = React.useState(false);
        const [svgCode, setSvgCode] = React.useState('');
        const [height, setHeight] = React.useState(512);
        const [width, setWidth] = React.useState(512);
        const [pngDataUrl, setPngDataUrl] = React.useState(null);
        const [errorMessage, setErrorMessage] = React.useState('');

        const menuRef = React.useRef(null);

        React.useEffect(() => {
          const savedTheme = localStorage.getItem('svg-to-png-theme');

          if (savedTheme) {
            setIsDarkMode(JSON.parse(savedTheme));
          }
        }, []);

        React.useEffect(() => {
          document.body.classList.toggle('dark', isDarkMode);
        }, [isDarkMode]);

        React.useEffect(() => {
          const handleClickOutside = event => {
            if (menuRef.current && !menuRef.current.contains(event.target)) {
              setIsMenuOpen(false);
            }
          };

          document.addEventListener('mousedown', handleClickOutside);

          return () => {
            document.removeEventListener('mousedown', handleClickOutside);
          };
        }, []);

        const toggleTheme = () => {
          localStorage.setItem('svg-to-png-theme', !isDarkMode);

          setIsDarkMode(!isDarkMode);
          setIsMenuOpen(false);
        };

        const convertSVGToPNG = () => {
          setPngDataUrl(null);
          setErrorMessage('');

          try {
            if (!svgCode.trim()) {
              setErrorMessage('Enter SVG code');
              return;
            }

            if (height < 1 || width < 1) {
              setErrorMessage('Height and width must be greater than 0');
              return;
            }

            const svg = new Blob([svgCode], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(svg);

            const img = new Image();

            img.onerror = () => {
              URL.revokeObjectURL(url);
              setErrorMessage('Invalid SVG: Unable to load image');
            };

            img.onload = () => {
              try {
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                const scale = Math.min(width / img.width, height / img.height);
                const scaledWidth = img.width * scale;
                const scaledHeight = img.height * scale;
                const x = (width - scaledWidth) / 2;
                const y = (height - scaledHeight) / 2;

                ctx.drawImage(img, x, y, scaledWidth, scaledHeight);
                const pngDataUrl = canvas.toDataURL('image/png');
                setPngDataUrl(pngDataUrl);

                URL.revokeObjectURL(url);
              } catch (drawError) {
                setErrorMessage('Error converting SVG: ' + drawError.message);
              }
            };

            img.src = url;
          } catch (error) {
            setErrorMessage('Conversion error: ' + error.message);
          }
        };

        const randomString = () => {
          const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';

          let randomString = '';

          for (let i = 0; i < 10; i++) {
            const randomIndex = Math.floor(Math.random() * characters.length);
            randomString += characters.charAt(randomIndex);
          }

          return randomString;
        };

        const downloadPNG = () => {
          if (pngDataUrl) {
            const link = document.createElement('a');
            link.download = randomString() + '.png';
            link.href = pngDataUrl;
            link.click();
          }
        };

        return (
          <React.Fragment>
            <header>
              <div className="header-content">
                <div>
                  <h1>SVG to PNG Converter</h1>
                  <p className="tagline">Transform your SVG files into high-quality PNG images instantly</p>
                </div>

                <div className="header-menu" ref={menuRef}>
                  <button className="menu-toggle" onClick={() => setIsMenuOpen(!isMenuOpen)} aria-label="Menu">
                    â‹®
                  </button>

                  {isMenuOpen && (
                    <div className="dropdown-menu">
                      <button className="dropdown-item" onClick={toggleTheme}>
                        {isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'}
                      </button>
                      <a
                        className="dropdown-item"
                        href="https://github.com/patel-priyank/SVG-to-PNG"
                        target="_blank"
                        rel="noopener noreferrer"
                        onClick={() => setIsMenuOpen(false)}
                      >
                        View Source Code
                      </a>
                    </div>
                  )}
                </div>
              </div>
            </header>

            <section>
              <h2>SVG code</h2>

              <textarea
                value={svgCode}
                onChange={e => setSvgCode(e.target.value)}
                placeholder="Paste your SVG code here"
              />

              <button onClick={convertSVGToPNG}>Convert</button>

              {pngDataUrl && (
                <button className="ml-8" onClick={downloadPNG}>
                  Download
                </button>
              )}
            </section>

            <section>
              <h2>Image size</h2>

              <div className="size-inputs">
                <div className="size-input">
                  <label htmlFor="height">Height (px)</label>
                  <input
                    type="number"
                    name="height"
                    value={height}
                    onChange={e => setHeight(e.target.value)}
                    placeholder="Height"
                  />
                </div>

                <div className="size-input">
                  <label htmlFor="width">Width (px)</label>
                  <input
                    type="number"
                    name="width"
                    value={width}
                    onChange={e => setWidth(e.target.value)}
                    placeholder="Width"
                  />
                </div>
              </div>
            </section>

            <section>
              <h2>Preview</h2>

              {errorMessage ? (
                <div className="error-message">{errorMessage}</div>
              ) : pngDataUrl ? (
                <img id="preview-image" src={pngDataUrl} alt="Converted PNG" />
              ) : (
                <p>Converted image will appear here</p>
              )}
            </section>
          </React.Fragment>
        );
      }

      ReactDOM.render(<SVGToPNGConverter />, document.getElementById('root'));
    </script>
  </body>
</html>
